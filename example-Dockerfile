# better to stick with lts
FROM node:lts

# node name to deploy subgraph
ENV node "localhost"

# copy current data to container
WORKDIR /app
COPY . .

# install deps
RUN yarn install

# add node to package.json
RUN sed "s|lerna run create-remote.*|lerna run create-remote -- --node ${node}\",|g" -i package.json
RUN sed "s|lerna run remove-remote.*|lerna run remove-remote -- --node ${node}\",|g" -i package.json
RUN sed "s|lerna run deploy-remote.*|lerna run deploy-remote -- --node ${node} --version-label 0.0.1\"|g" -i package.json

RUN cat package.json

# deploy
RUN yarn codegen
RUN yarn build --network baobab

CMD ["/bin/bash"]

# uncomment if you want to build image which will deploy to remote
#CMD ["/bin/bash", "-c", "yarn create-remote; yarn deploy-remote --network baobab"]
